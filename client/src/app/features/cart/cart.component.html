<section class="py-8">
  <div class="max-w-screen-2xl px-4 mx-auto">
    <div class="mb-6 flex items-center justify-between gap-4">
      <h1 class="text-2xl font-semibold text-gray-900">Carrello</h1>
      <a
        class="inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-900"
        routerLink="/shop"
        aria-label="Torna a fare acquisti"
      >
        Torna a fare acquisti
      </a>
    </div>

    @if (cartService.cart(); as cart) {
      @if (cart.items.length > 0) {
        <div class="hidden md:block">
          <div class="overflow-x-auto rounded-lg border border-slate-200">
            <table class="min-w-full text-left text-sm">
              <thead class="bg-slate-50 text-xs uppercase text-slate-500">
                <tr>
                  <th class="px-4 py-3 font-medium">Immagine</th>
                  <th class="px-4 py-3 font-medium">Prodotto</th>
                  <th class="px-4 py-3 font-medium">Prezzo</th>
                  <th class="px-4 py-3 font-medium">Quantità</th>
                  <th class="px-4 py-3 text-right font-medium">Totale</th>
                </tr>
              </thead>
              <tbody>
                @for (item of cart.items; track item.productId) {
                  <tr class="border-t border-slate-200">
                    <td class="px-4 py-4">
                      <a
                        class="inline-flex rounded-md ring-slate-200 transition hover:ring-2"
                        [routerLink]="['/shop', item.productId]"
                        [attr.aria-label]="'Apri dettaglio prodotto ' + item.productName"
                      >
                        <img
                          class="h-14 w-14 rounded-md object-contain bg-white"
                          [src]="item.pictureUrl"
                          [alt]="item.productName"
                        />
                      </a>
                    </td>
                    <td class="px-4 py-4">
                      <p class="font-medium text-slate-900">{{ item.productName }}</p>
                    </td>
                    <td class="px-4 py-4 text-slate-700">{{ item.price | currency }}</td>
                    <td class="px-4 py-4">
                      <div class="inline-flex items-center gap-2">
                        <button
                          mat-icon-button
                          aria-label="Decrementa quantità"
                          (click)="decrease(item)"
                        >
                          <mat-icon>remove</mat-icon>
                        </button>
                        <input
                          class="h-10 w-16 rounded-md border border-slate-200 text-center"
                          type="number"
                          min="0"
                          step="1"
                          [value]="item.quantity"
                          (input)="onQuantityInput(item, $event)"
                        />
                        <button
                          mat-icon-button
                          aria-label="Incrementa quantità"
                          (click)="increase(item)"
                        >
                          <mat-icon>add</mat-icon>
                        </button>
                      </div>
                    </td>
                    <td class="px-4 py-4 text-right font-semibold text-slate-900">
                      {{ item.price * item.quantity | currency }}
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>

        <div class="grid gap-4 md:hidden">
          @for (item of cart.items; track item.productId) {
            <div class="rounded-lg border border-slate-200 p-4">
              <div class="flex items-start gap-4">
                <a
                  class="inline-flex rounded-md ring-slate-200 transition hover:ring-2"
                  [routerLink]="['/shop', item.productId]"
                  [attr.aria-label]="'Apri dettaglio prodotto ' + item.productName"
                >
                  <img
                    class="h-14 w-14 rounded-md object-contain bg-white"
                    [src]="item.pictureUrl"
                    [alt]="item.productName"
                  />
                </a>
                <div class="flex-1">
                  <p class="text-base font-semibold text-slate-900">{{ item.productName }}</p>
                  <p class="text-sm text-slate-600">Prezzo: {{ item.price | currency }}</p>
                  <p class="text-sm text-slate-600">
                    Totale: {{ item.price * item.quantity | currency }}
                  </p>
                </div>
              </div>
              <div class="mt-4 flex items-center gap-3">
                <button mat-icon-button aria-label="Decrementa quantità" (click)="decrease(item)">
                  <mat-icon>remove</mat-icon>
                </button>
                <input
                  class="h-10 w-20 rounded-md border border-slate-200 text-center"
                  type="number"
                  min="0"
                  step="1"
                  [value]="item.quantity"
                  (input)="onQuantityInput(item, $event)"
                />
                <button mat-icon-button aria-label="Incrementa quantità" (click)="increase(item)">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          }
        </div>

        <div class="mt-6 flex justify-end">
          <div class="w-full max-w-sm rounded-lg border border-slate-200 bg-slate-50 px-6 py-4">
            <h2 class="text-base font-semibold text-slate-900">Riepilogo ordine</h2>
            <div class="mt-4 space-y-2 text-sm text-slate-600">
              <div class="flex items-center justify-between">
                <span>Subtotale</span>
                <span class="font-medium text-slate-900">{{ subtotal() | currency }}</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Spedizione</span>
                <span class="font-medium text-slate-900">{{ shippingCost() | currency }}</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Sconto</span>
                <span class="font-medium text-slate-900">-{{ discount() | currency }}</span>
              </div>
            </div>
            <div
              class="mt-4 flex items-center justify-between border-t border-slate-200 pt-4 text-base"
            >
              <span class="font-semibold text-slate-900">Totale ordine</span>
              <span class="text-lg font-semibold text-slate-900">{{
                orderTotal() | currency
              }}</span>
            </div>
          </div>
        </div>
      } @else {
        <div class="rounded-lg border border-slate-200 bg-white p-8 text-center">
          <p class="text-base font-medium text-slate-900">Il carrello è vuoto.</p>
          <a class="mt-4 inline-flex text-sm text-slate-600 hover:text-slate-900" routerLink="/shop"
            >Vai allo shop</a
          >
        </div>
      }
    } @else {
      <div class="rounded-lg border border-slate-200 bg-white p-8 text-center">
        <p class="text-base font-medium text-slate-900">Il carrello è vuoto.</p>
        <a class="mt-4 inline-flex text-sm text-slate-600 hover:text-slate-900" routerLink="/shop"
          >Vai allo shop</a
        >
      </div>
    }
  </div>
</section>
