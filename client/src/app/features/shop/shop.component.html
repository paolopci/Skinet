<div class="flex flex-col gap-3 px-4">
  @if (pagination()) {
    <div class="flex items-center justify-between gap-3">
      <div class="flex flex-1 items-center justify-start">
        <mat-paginator
          [length]="pagination()!.totalCount"
          [pageIndex]="pagination()!.pageIndex - 1"
          [pageSize]="pagination()!.pageSize"
          [pageSizeOptions]="[5, 10, 20, 50]"
          [showFirstLastButtons]="true"
          (page)="onPageChange($event)"
        ></mat-paginator>
      </div>
      <div class="flex items-center gap-2 pb-3">
        <form
          #searchForm="ngForm"
          (ngSubmit)="onSearchChange()"
          class="relative flex items-center"
        >
          <input
            type="search"
            name="search"
            [(ngModel)]="shopParams.search"
            placeholder="Search"
            class="h-9 w-64 rounded-md border border-slate-300 px-3 pr-10 text-sm text-slate-900"
          />
          <button
            mat-icon-button
            type="submit"
            class="absolute right-1"
            aria-label="Search"
          >
            <mat-icon>search</mat-icon>
          </button>
        </form>
        <button mat-stroked-button (click)="openFiltersDialog()">
          <mat-icon>filter_list</mat-icon>
          <span>Filters</span>
        </button>
        <button mat-stroked-button [matMenuTriggerFor]="sortMenu">
          <mat-icon>{{ selectedSortIcon }}</mat-icon>
          <span>Ordina: {{ selectedSortLabel }}</span>
        </button>
      </div>
    </div>
  } @else {
    <div class="flex justify-end gap-2 pb-3">
      <form
        #searchForm="ngForm"
        (ngSubmit)="onSearchChange()"
        class="relative flex items-center"
      >
        <input
          type="search"
          name="search"
          [(ngModel)]="shopParams.search"
          placeholder="Search"
          class="h-9 w-64 rounded-md border border-slate-300 px-3 pr-10 text-sm text-slate-900"
        />
        <button
          mat-icon-button
          type="submit"
          class="absolute right-1"
          aria-label="Search"
        >
          <mat-icon>search</mat-icon>
        </button>
      </form>
      <button mat-stroked-button (click)="openFiltersDialog()">
        <mat-icon>filter_list</mat-icon>
        <span>Filters</span>
      </button>
      <button mat-stroked-button [matMenuTriggerFor]="sortMenu">
        <mat-icon>{{ selectedSortIcon }}</mat-icon>
        <span>Ordina: {{ selectedSortLabel }}</span>
      </button>
    </div>
  }
</div>

<mat-menu #sortMenu="matMenu">
  <mat-selection-list [multiple]="false" (selectionChange)="onSortChange($event)">
    @for (sort of sortOptions; track $index) {
      <mat-list-option [value]="sort.value" [selected]="selectedSort === sort.value">
        {{ sort.name }}
      </mat-list-option>
    }
  </mat-selection-list>
</mat-menu>

@if (selectedBrands.length || selectedTypes.length) {
  <div class="px-4 mb-2 flex flex-wrap items-center gap-2 text-sm text-slate-600">
    <span class="font-semibold">Active filters:</span>
    @for (brand of selectedBrands; track brand) {
      <span class="rounded-full bg-slate-100 px-2 py-0.5">Brand: {{ brand }}</span>
    }
    @for (type of selectedTypes; track type) {
      <span class="rounded-full bg-slate-100 px-2 py-0.5">Type: {{ type }}</span>
    }
  </div>
}

@if (products().length > 0) {
  <div class="grid grid-cols-4 gap-4 px-4">
    @for (product of products(); track product.id) {
      <app-product-item [product]="product"></app-product-item>
    }
  </div>
  @if (pagination()) {
    <div class="px-4 pt-4 flex justify-center">
      <mat-paginator
        [length]="pagination()!.totalCount"
        [pageIndex]="pagination()!.pageIndex - 1"
        [pageSize]="pagination()!.pageSize"
        [pageSizeOptions]="[5, 10, 20, 50]"
        [showFirstLastButtons]="true"
        (page)="onPageChange($event)"
      ></mat-paginator>
    </div>
  }
} @else {
  <div class="px-4 py-12 text-center text-slate-500">No products match the selected filters.</div>
}
