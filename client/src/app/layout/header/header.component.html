<header
  class="sticky top-0 z-50 w-full border-b border-slate-200 bg-white/95 p-3 shadow-sm backdrop-blur-md transition-shadow duration-200 md:shadow-md"
>
  <div
    class="flex items-center justify-between gap-6 max-w-screen-2xl mx-auto md:grid md:grid-cols-3 md:gap-6 md:items-center"
  >
    <div class="flex items-center gap-3 md:justify-self-start">
      <button
        mat-icon-button
        class="lg:hidden"
        [matMenuTriggerFor]="mobileMenu"
        aria-label="Apri menu"
      >
        <mat-icon>menu</mat-icon>
      </button>
      <img
        class="h-12 w-auto object-contain"
        routerLink="/"
        src="/images/logo.png"
        alt="app logo"
      />
    </div>
    <nav
      class="hidden lg:flex items-center gap-6 my-2 uppercase text-lg tracking-wide font-medium lg:justify-self-center"
    >
      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="exactMatch">Home</a>
      <a routerLink="/shop" routerLinkActive="active" [routerLinkActiveOptions]="exactMatch"
        >Shop</a
      >
      <a routerLink="/test-error" routerLinkActive="active">Errors</a>
    </nav>
    <div class="flex items-center gap-3 md:justify-self-end">
      <!-- Badge con totale pezzi nel carrello -->
      <a
        class="cart-icon"
        [matBadge]="cartService.totalItemsCount()"
        [matBadgeHidden]="cartService.totalItemsCount() === 0"
        matBadgeSize="large"
        routerLink="/cart"
        routerLinkActive="active"
      >
        <mat-icon>shopping_cart</mat-icon>
      </a>
      @if (isLoggedIn()) {
        <button
          mat-stroked-button
          class="user-menu-trigger items-center gap-2"
          [matMenuTriggerFor]="userMenu"
          aria-label="Apri menu utente"
        >
          <mat-icon>person</mat-icon>
          <span class="max-w-[160px] truncate">{{ user()?.email ?? 'Account' }}</span>
          <mat-icon>expand_more</mat-icon>
        </button>
      } @else {
        <div class="hidden md:flex items-center gap-2">
          <button mat-stroked-button routerLink="/login">Login</button>
          <button mat-stroked-button routerLink="/register">Register</button>
        </div>
      }
    </div>
  </div>
</header>

<mat-menu #userMenu="matMenu">
  <button mat-menu-item routerLink="/cart">
    <mat-icon>shopping_cart</mat-icon>
    <span>My cart</span>
  </button>
  <button mat-menu-item disabled>
    <mat-icon>receipt_long</mat-icon>
    <span>My orders</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span>Logout</span>
  </button>
</mat-menu>

<mat-menu #mobileMenu="matMenu" panelClass="mobile-menu">
  <button
    mat-menu-item
    routerLink="/"
    routerLinkActive="active"
    [routerLinkActiveOptions]="exactMatch"
  >
    <mat-icon>home</mat-icon>
    <span>Home</span>
  </button>
  <button
    mat-menu-item
    routerLink="/shop"
    routerLinkActive="active"
    [routerLinkActiveOptions]="exactMatch"
  >
    <mat-icon>storefront</mat-icon>
    <span>Shop</span>
  </button>
  <button mat-menu-item routerLink="/test-error" routerLinkActive="active">
    <mat-icon>error_outline</mat-icon>
    <span>Errors</span>
  </button>
  <mat-divider></mat-divider>
  @if (isLoggedIn()) {
    <button mat-menu-item routerLink="/cart">
      <mat-icon>shopping_cart</mat-icon>
      <span>My cart</span>
    </button>
    <button mat-menu-item disabled>
      <mat-icon>receipt_long</mat-icon>
      <span>My orders</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="logout()">
      <mat-icon>logout</mat-icon>
      <span>Logout</span>
    </button>
  } @else {
    <button mat-menu-item routerLink="/login">
      <mat-icon>login</mat-icon>
      <span>Login</span>
    </button>
    <button mat-menu-item routerLink="/register">
      <mat-icon>person_add</mat-icon>
      <span>Register</span>
    </button>
  }
</mat-menu>
